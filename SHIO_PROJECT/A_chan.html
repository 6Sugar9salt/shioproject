<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem A: Character Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen selection:bg-pink-500 selection:text-white">

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <header class="flex items-center justify-between mb-8 border-b border-gray-700 pb-6">
            <div>
                <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-400 to-purple-500">
                    Gem A <span class="text-sm text-gray-400 font-normal ml-2">for Google Veo 3.1</span>
                </h1>
                <p class="text-gray-400 text-sm mt-1">„Ç≠„É£„É©„ÇØ„Çø„ÉºÁîªÂÉè„Åã„Çâ„Äå‰∏çÂ§â„ÅÆJSONË®≠ÂÆöË≥áÊñô„Äç„ÇíÁîüÊàê„Åô„Çã„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„Éà„ÉÑ„Éº„É´</p>
            </div>
        </header>

        <!-- TOP SECTION: Settings (Full Width) -->
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                
                <!-- 1. API Key -->
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-center">
                        <label class="block text-xs font-bold text-gray-400 uppercase flex items-center gap-2">
                            <i class="fas fa-key text-yellow-500"></i> 1. Google Gemini API Key
                        </label>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-[10px] text-pink-400 hover:underline">
                            API„Ç≠„Éº„ÇíÂèñÂæó <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                    
                    <input type="password" id="api-key-input" placeholder="AIzaSy..." class="w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-sm focus:border-pink-500 outline-none transition font-mono">
                    
                    <!-- Moved Button Here: Compact & Pink with Annotation -->
                    <div class="flex items-center gap-3">
                        <button onclick="checkAvailableModels()" id="check-models-btn" class="bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded-lg text-xs transition shadow-md flex items-center justify-center gap-2 border border-pink-400/20 whitespace-nowrap">
                            <i class="fas fa-sync-alt"></i> API„Ç≠„ÉºË™≠„ÅøËæº„Åø
                        </button>
                        <p class="text-[10px] text-gray-400 leading-tight">
                            ‚ÄªAPI„Ç≠„ÉºÂÖ•ÂäõÂæå‚ÄùË™≠„ÅøËæº„Åø‚Äù„ÇíÊäº„Åô„Åì„Å®„ÅßAPI„Ç≠„Éº„Å´ÂØæÂøú„Åó„Åü„É¢„Éá„É´„É™„Çπ„Éà„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                        </p>
                    </div>
                </div>

                <!-- 2. Model Selection -->
                <div class="flex flex-col gap-3">
                    <div class="flex justify-between items-center">
                        <label class="block text-xs font-bold text-gray-400 uppercase flex items-center gap-2">
                            <i class="fas fa-robot text-blue-400"></i> 2. Select Model
                        </label>
                    </div>
                    
                    <div class="flex items-center gap-2 bg-gray-900 p-2 rounded-lg border border-gray-600 relative h-[42px]">
                        <select id="model-select" class="w-full bg-transparent text-sm text-gray-100 focus:outline-none cursor-pointer appearance-none font-medium pl-2">
                            <optgroup label="Recommended" class="text-gray-900 bg-white">
                                <option value="gemini-3.0-pro-preview">Gemini 3.0 Pro Preview (ÊúÄÊñ∞„ÉªÊúÄÂº∑)</option>
                                <option value="gemini-2.5-flash-preview-09-2025" selected>Gemini 2.5 Flash Preview (È´òÈÄü)</option>
                            </optgroup>
                            <optgroup label="Stable" class="text-gray-900 bg-white">
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                            </optgroup>
                        </select>
                        <i class="fas fa-chevron-down text-gray-400 absolute right-4 text-xs pointer-events-none"></i>
                    </div>
                    <div id="model-check-status" class="text-[10px] font-mono text-gray-500 min-h-[1.5em] flex items-center"></div>
                </div>
            </div>
            
            <p class="text-[10px] text-gray-500 mt-2 border-t border-gray-700 pt-2">
                ‚Äª „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÅÆ„Åü„ÇÅ„ÄÅAPI„Ç≠„Éº„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åô„Çã„Åü„Å≥„Å´ÂÖ•Âäõ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
            </p>
        </div>

        <!-- MAIN CONTENT: 2 Columns -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8 items-start">
            
            <!-- Left Column: Inputs -->
            <div class="space-y-6">
                
                <!-- 3. Image Upload -->
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                    <h2 class="text-xs font-bold text-gray-400 uppercase mb-3 flex items-center gap-2">
                        <i class="fas fa-image text-pink-400"></i> 3. Character Image
                    </h2>
                    
                    <div id="drop-zone" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-pink-500 hover:bg-gray-750 transition relative overflow-hidden group min-h-[280px] flex flex-col items-center justify-center">
                        <input type="file" id="file-input" accept="image/*" class="hidden" onchange="handleFileSelect(this)">
                        
                        <div id="upload-prompt" class="space-y-4 pointer-events-none transition-opacity duration-300">
                            <div class="w-20 h-20 bg-gray-700 rounded-full flex items-center justify-center mx-auto group-hover:bg-gray-600 transition shadow-inner">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 group-hover:text-pink-400 transition"></i>
                            </div>
                            <div>
                                <p class="text-gray-300 text-base font-bold">ÁîªÂÉè„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó</p>
                                <p class="text-gray-500 text-xs mt-1">„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</p>
                            </div>
                        </div>

                        <img id="preview-img" class="hidden absolute inset-0 w-full h-full object-contain bg-gray-900 pointer-events-none">
                    </div>
                </div>

                <!-- 4. Text Context -->
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg">
                    <h2 class="text-xs font-bold text-gray-400 uppercase mb-3 flex items-center gap-2">
                        <i class="fas fa-pen text-purple-400"></i> 4. Additional Context
                    </h2>
                    <textarea id="context-input" rows="4" placeholder="ÂêçÂâç„ÄÅÊÄßÊ†º„ÄÅÁâπÂæ¥„ÄÅË£úË∂≥ÊÉÖÂ†±„Å™„Å©„Åå„ÅÇ„Çå„Å∞„Åì„Åì„Å´ÂÖ•ÂäõÔºà‰ªªÊÑèÔºâ..." class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-sm focus:border-purple-500 outline-none transition placeholder-gray-600 resize-none"></textarea>
                </div>

                <!-- 5. Generate Button -->
                <button id="generate-btn" onclick="generateGemA()" class="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-5 rounded-xl shadow-lg transform transition active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 text-lg border border-white/10 group">
                    <i class="fas fa-magic text-xl group-hover:rotate-12 transition"></i> 
                    <span>Ëß£Êûê„Åó„Å¶JSON„ÇíÁîüÊàê</span>
                </button>

            </div>

            <!-- Right Column: Output -->
            <div class="space-y-6 h-full md:min-h-[800px]">
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-lg h-full flex flex-col relative overflow-hidden">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-4">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <i class="fas fa-code text-green-400"></i> Output JSON
                        </h2>
                        <span id="status-indicator" class="text-xs font-mono text-gray-500 bg-gray-900 px-2 py-1 rounded border border-gray-700">READY</span>
                    </div>

                    <div class="flex-1 relative min-h-[500px]">
                        <textarea id="output-json" readonly class="w-full h-full bg-gray-900 border border-gray-600 rounded-lg p-4 font-mono text-xs text-green-400 focus:outline-none resize-none leading-relaxed" placeholder="// „Åì„Åì„Å´ÁîüÊàê„Åï„Çå„Åü‰∏çÂ§â„ÅÆJSONË®≠ÂÆöË≥áÊñô„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô..."></textarea>
                        
                        <!-- Loading Overlay -->
                        <div id="loading-overlay" class="absolute inset-0 bg-gray-900/90 backdrop-blur-md flex flex-col items-center justify-center rounded-lg hidden z-10 transition-all duration-300">
                            <div class="relative w-20 h-20 mb-6">
                                <div class="absolute inset-0 border-4 border-gray-700 rounded-full"></div>
                                <div class="absolute inset-0 border-4 border-pink-500 rounded-full border-t-transparent animate-spin"></div>
                                <i class="fas fa-robot absolute inset-0 flex items-center justify-center text-gray-500 text-xl animate-pulse"></i>
                            </div>
                            
                            <p id="loading-text" class="text-pink-400 text-sm font-bold animate-pulse mb-8 tracking-wider">ANALYZING...</p>
                            
                            <!-- Cancel Button -->
                            <button onclick="cancelGeneration()" class="bg-red-500/10 hover:bg-red-500/20 border border-red-500/50 text-red-400 hover:text-red-300 px-6 py-2 rounded-full text-xs font-bold transition flex items-center gap-2 group">
                                <i class="fas fa-stop-circle group-hover:scale-110 transition"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-2 gap-4 mt-6 pt-4 border-t border-gray-700">
                        <button onclick="copyJson()" id="copy-btn" disabled class="bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl text-sm font-bold transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                            <i class="fas fa-copy"></i> Copy JSON
                        </button>
                        <button onclick="downloadJson()" id="download-btn" disabled class="bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl text-sm font-bold transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i> Download .json
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Main Application Logic -->
    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // System Prompt (Gem A Logic embedded here)
        const SYSTEM_INSTRUCTION = `
# Role
You are a "Character Visual Architect" for Google Veo 3.1.
Analyze the given image and text to create a high-quality English prompt that preserves the character's "Identity" and "Vibe" for video generation.

# Objectives
1. Extract Structure, Ignore Medium: Force convert any 2D/sketch input into "High-fidelity 3D rendered anime style".
2. **Exclude Pose & Action (CRITICAL):**
   - Do NOT describe the character's pose (e.g., sitting, standing, running, crossed legs) or camera angle.
   - Focus ONLY on physical attributes (face, hair, body type) and outfit.
   - The prompt must describe the character as if they are a 3D model in a neutral state (or focusing purely on appearance), ready to be animated.
3. Analyze Context: Prioritize face expression and overall vibe.
4. Style Enforcement: Use mandatory keywords: "High-fidelity 3D rendered anime style", "Cinematic lighting", "Subsurface scattering", "Octane render aesthetic".
5. Output Format: JSON only.

# Output JSON Structure
{
  "character_core": { "face_and_eyes": "...", "vibe_and_colors": "..." },
  "outfit_details": "...",
  "veo_optimized_prompt": "..."
}
        `;

        // --- UI Logic ---
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const previewImg = document.getElementById('preview-img');
        const uploadPrompt = document.getElementById('upload-prompt');
        let currentFile = null;

        // API Key Management
        const apiKeyInput = document.getElementById('api-key-input');
        const modelSelect = document.getElementById('model-select');
        
        // Abort Controller for Cancellation
        let abortController = null;

        // Removed localStorage loading logic for security
        window.addEventListener('DOMContentLoaded', () => {
            // No auto-load of key
        });

        // Removed saveApiKey function

        // --- Model Checking Logic ---
        window.checkAvailableModels = async () => {
            const apiKey = apiKeyInput.value.trim();
            const statusDiv = document.getElementById('model-check-status');
            const checkBtn = document.getElementById('check-models-btn');
            
            if (!apiKey) {
                statusDiv.textContent = "API Key required.";
                statusDiv.className = "text-[10px] font-mono text-red-400 mt-2";
                return;
            }

            statusDiv.textContent = "Checking models...";
            statusDiv.className = "text-[10px] font-mono text-yellow-400 animate-pulse mt-2";
            checkBtn.disabled = true;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                const data = await response.json();

                if (data.error) throw new Error(data.error.message);
                
                if (data.models) {
                    const relevantModels = data.models.filter(m => 
                        m.supportedGenerationMethods && 
                        m.supportedGenerationMethods.includes("generateContent") &&
                        (m.name.includes("gemini") || m.name.includes("3.0") || m.name.includes("2.5"))
                    ).sort((a, b) => b.name.localeCompare(a.name));

                    modelSelect.innerHTML = "";
                    
                    const group = document.createElement('optgroup');
                    group.label = "Detected Available Models";
                    group.className = "text-gray-900 bg-white";
                    
                    let found3 = false;

                    relevantModels.forEach(m => {
                        const option = document.createElement('option');
                        const modelId = m.name.replace('models/', '');
                        option.value = modelId;
                        
                        let displayName = modelId;
                        if (modelId.includes("3.0-pro")) {
                            displayName = "‚ú® " + modelId + " (ÊúÄÊñ∞)";
                            found3 = true;
                        } else if (modelId.includes("2.5")) {
                             displayName = "üöÄ " + modelId;
                        }
                        
                        option.textContent = displayName;
                        group.appendChild(option);
                    });

                    modelSelect.appendChild(group);
                    
                    const count = relevantModels.length;
                    statusDiv.textContent = `OK: ${count} models found.`;
                    statusDiv.className = "text-[10px] font-mono text-green-400 mt-2";
                    
                    if (found3) {
                         const opts = modelSelect.options;
                         for(let i=0; i<opts.length; i++) {
                             if(opts[i].value.includes("3.0")) {
                                 modelSelect.selectedIndex = i;
                                 break;
                             }
                         }
                    }
                }

            } catch (e) {
                console.error(e);
                statusDiv.textContent = "Error: Check API Key.";
                statusDiv.className = "text-[10px] font-mono text-red-400 mt-2";
            } finally {
                checkBtn.disabled = false;
            }
        };


        // Drag & Drop
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-pink-500'); });
        dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('border-pink-500'); });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-pink-500');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });

        window.handleFileSelect = (input) => {
            if (input.files.length) handleFile(input.files[0]);
        };

        function handleFile(file) {
            if (!file.type.startsWith('image/')) return;
            currentFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                previewImg.classList.remove('hidden');
                uploadPrompt.classList.add('opacity-0');
            };
            reader.readAsDataURL(file);
        }

        // --- Cancellation Logic ---
        window.cancelGeneration = () => {
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
            
            // Reset UI immediately
            const loading = document.getElementById('loading-overlay');
            const status = document.getElementById('status-indicator');
            const loadingText = document.getElementById('loading-text');
            const btns = [document.getElementById('generate-btn'), document.getElementById('copy-btn'), document.getElementById('download-btn')];

            loading.classList.add('hidden');
            status.textContent = "CANCELLED";
            status.className = "text-xs font-mono text-yellow-500 bg-gray-900 px-2 py-1 rounded border border-yellow-900";
            loadingText.textContent = "Gem A is analyzing..."; // Reset text
            
            btns.forEach(b => b.disabled = false);
            document.getElementById('download-btn').disabled = true; // Keep download disabled until success
            document.getElementById('copy-btn').disabled = true;
        };

        // Cancellable Wait Helper
        function cancellableWait(ms, signal) {
            return new Promise((resolve, reject) => {
                const timer = setTimeout(resolve, ms);
                
                if (signal) {
                    signal.addEventListener('abort', () => {
                        clearTimeout(timer);
                        reject(new DOMException("Aborted", "AbortError"));
                    });
                }
            });
        }


        // --- Generation Logic ---
        window.generateGemA = async () => {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert('API„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            if (!currentFile) {
                alert('ÁîªÂÉè„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            // Init AbortController
            abortController = new AbortController();
            const signal = abortController.signal;

            const selectedModel = document.getElementById('model-select').value;
            const contextText = document.getElementById('context-input').value;
            const outputArea = document.getElementById('output-json');
            const loading = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            const status = document.getElementById('status-indicator');
            const btns = [document.getElementById('generate-btn'), document.getElementById('copy-btn'), document.getElementById('download-btn')];

            // UI State: Loading
            loading.classList.remove('hidden');
            btns.forEach(b => b.disabled = true);
            status.textContent = `ANALYZING...`;
            status.className = "text-xs font-mono text-pink-400 animate-pulse bg-gray-900 px-2 py-1 rounded border border-pink-900";
            outputArea.value = ""; // Clear previous output

            try {
                const genAI = new GoogleGenerativeAI(apiKey);
                
                const model = genAI.getGenerativeModel({ 
                    model: selectedModel,
                    systemInstruction: SYSTEM_INSTRUCTION
                });

                const imageBase64 = await fileToGenerativePart(currentFile);
                
                const prompt = contextText 
                    ? `Analyze this image. Additional Character Context: ${contextText}`
                    : "Analyze this image.";

                // Retry Logic
                let result;
                let attempt = 0;
                const maxRetries = 6; 
                let delay = 2000; 

                while (attempt <= maxRetries) {
                    // Check cancellation before request
                    if (signal.aborted) throw new DOMException("Aborted", "AbortError");

                    try {
                        result = await model.generateContent([prompt, imageBase64]);
                        break; 
                    } catch (e) {
                        if (signal.aborted) throw new DOMException("Aborted", "AbortError");

                        // Retry conditions
                        if ((e.message.includes('429') || e.message.includes('503')) && attempt < maxRetries) {
                            
                            let waitTime = delay;
                            const match = e.message.match(/retry in ([0-9.]+)/);
                            if (match && match[1]) {
                                waitTime = Math.ceil(parseFloat(match[1])) * 1000 + 2000;
                            } else {
                                waitTime = delay;
                                delay *= 2; 
                            }
                            
                            const waitSec = Math.ceil(waitTime / 1000);
                            status.textContent = `WAITING... ${waitSec}s`;
                            loadingText.textContent = `API Quota reached. Cooling down for ${waitSec}s...`;
                            
                            // Use Cancellable Wait
                            await cancellableWait(waitTime, signal);
                            
                            attempt++;
                            status.textContent = `RETRYING (${attempt})...`;
                            loadingText.textContent = `Retrying analysis... (${attempt})`;
                        } else {
                            throw e; 
                        }
                    }
                }

                const response = await result.response;
                let text = response.text();
                text = text.replace(/```json\n|\n```/g, '').trim();

                outputArea.value = text;
                status.textContent = "COMPLETED";
                status.className = "text-xs font-mono text-green-400 bg-gray-900 px-2 py-1 rounded border border-green-900";
                btns.forEach(b => b.disabled = false);
                
                // Hide loading (success path)
                loading.classList.add('hidden');
                loadingText.textContent = "ANALYZING...";

            } catch (error) {
                // Handle Cancellation
                if (error.name === 'AbortError') {
                    console.log("Generation cancelled by user.");
                    status.textContent = "CANCELLED";
                    status.className = "text-xs font-mono text-yellow-500 bg-gray-900 px-2 py-1 rounded border border-yellow-900";
                    return;
                }

                console.error(error);
                let errorMsg = "Error: " + error.message;
                
                if (error.message.includes('429')) {
                    errorMsg += "\n\n(API Quota Exceeded. Try using the Flash model or wait a moment.)";
                }

                outputArea.value = errorMsg;
                status.textContent = "ERROR";
                status.className = "text-xs font-mono text-red-500 bg-gray-900 px-2 py-1 rounded border border-red-900";
                
                loading.classList.add('hidden');
                document.getElementById('generate-btn').disabled = false;
                loadingText.textContent = "ANALYZING...";
            }
        };

        async function fileToGenerativePart(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64String = reader.result.split(',')[1];
                    resolve({
                        inlineData: {
                            data: base64String,
                            mimeType: file.type
                        }
                    });
                };
                reader.readAsDataURL(file);
            });
        }

        window.downloadJson = () => {
            const content = document.getElementById('output-json').value;
            if (!content) return;
            let filename = "gem_a_character.json";
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        window.copyJson = () => {
            const content = document.getElementById('output-json');
            if (!content.value) return;
            
            // Attempt clipboard API
            navigator.clipboard.writeText(content.value)
                .then(() => alert('Copied to clipboard!'))
                .catch(err => {
                    console.warn("Clipboard API blocked, fallback to execCommand");
                    content.select();
                    content.setSelectionRange(0, 99999); // Mobile
                    document.execCommand('copy');
                    alert('Copied to clipboard!');
                });
        };
    </script>
</body>
</html>